@page "/todo"
@inject IDialogService DialogService

<h1 id="header-by">By Ghais</h1>
<head>

</head>
<div>
    <h1 id="header-todos">todos</h1>

    <MudTextField Variant="Variant.Text" id="submit"
                  @bind-Value="@task" placeholder="Enter your todo"
                  @onkeyup="@SubmitByEnter" />
    <div class = "div-center">
    <button type="button" id="btn-submit" @onclick="AddTask" class="btn btn-primary"> Add task</button>
    <div class="divider"/>
    <button type="button" id="btn-delete" @onclick="DeleteAllTasks" class="btn btn-danger"> Delete all tasks</button>
    <br />
    <br />
    <h3 style="text-align:center;color:#C21807;" <em>Double click on a task to delete it</em></h3>
    </div>
    <br />
    <br />
</div>

    <MudDropContainer T="DropItem" Items="@_items" @ref="_container" ItemsSelector="@((item,dropzone) => item.Selector == dropzone)" ontimeupdate="1" ItemDropped="ItemUpdated" Class="d-flex flex-wrap flex-grow-1">
        <ChildContent>
            @for (int i = 0; i < 3; i++)
            {
            var dropzone = i==0 ? "To Do" : (i==1 ? "Doing" : "Done");
            <MudPaper Style="background-color: #ccffee; " Class="ma-4 flex-grow-1">
                    <MudList Clickable="true" Class="d-flex flex-column mud-height-full">
                        <MudListSubheader>
                            @dropzone
                        </MudListSubheader>
                        <MudDropZone T="DropItem" Identifier="@dropzone" Class="flex-grow-1" AllowReorder="true" />
                        
                    </MudList>
                </MudPaper>
            }
        </ChildContent>
        <ItemRenderer>
            <MudListItem  Style="border:2px solid  #ccffee; background-color: aquamarine ;" Text="@context.Name"@ondblclick="(() => DeleteTask(context.Name))" /> 
        </ItemRenderer>
    </MudDropContainer>



@code {
    int nrOfTasks = 0;
    string? task = null;
    List<Todo> tasks = new List<Todo>();
    List<Todo> tasksDone = new List<Todo>();
    private List<DropItem> _items = new List<DropItem>();
    private MudDropContainer<DropItem> _container;

    private void ItemUpdated(MudItemDropInfo<DropItem> dropItem)
    {
        dropItem.Item.Selector = dropItem.DropzoneIdentifier;
    }


    public class DropItem
    {
        public string Name { get; set; }
        public string Selector { get; set; }
    }

    void SubmitByEnter(KeyboardEventArgs e)
    {
        if (e.Key == "Enter" || e.Code == "NumpadEnter")
        {
            Console.WriteLine("Task Added");
            AddTask();
        }
    }

    void AddTask()
    {
        if (!String.IsNullOrEmpty(task?.Trim(' ')))
        {
            tasks.Add(new Todo { Text = task, Id = nrOfTasks++ });
            _items.Add(new DropItem() { Name = task, Selector = "To Do" });
        }
        StateHasChanged();
        _container.Refresh();
        task = null;
    }

    void DeleteTask(string text)
    {
        //tasks.Remove(item);
        //tasksDone.Add(item);
        for (int i = 0; i < _items.Count; i++)
        {
            if (_items[i].Name == text)
            {
                _items.RemoveAt(i);
                  StateHasChanged();
                 _container.Refresh();
                break;
            }
        }
    }

     public void DeleteAllTasks()
    {
        _items.Clear();
          StateHasChanged();
        _container.Refresh();
    }
}